store.jkkniu.edu.bd {
    # API requests
    handle /api/v1/* {
        reverse_proxy backend:4000 {
            header_up X-Forwarded-Prefix "/api/v1"
        }
    }
    
    # Static files handler
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
        encode gzip
    }
    
    # Security headers
    # header {
    #     Strict-Transport-Security "max-age=31536000;"
    #     X-Content-Type-Options "nosniff"
    #     Referrer-Policy "strict-origin-when-cross-origin"
    #     X-XSS-Protection "1; mode=block"
    #     X-Frame-Options "DENY"
    #     Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: blob: res.cloudinary.com; connect-src 'self' https://store.jkkniu.edu.bd https://res.cloudinary.com;"
    # }

    # after helmet use:
    header {
        # Required security headers from scan
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        X-Frame-Options "SAMEORIGIN"
        Permissions-Policy "camera=(), microphone=(), geolocation=(), interest-cohort=()"
        
        # Content Security Policy
        Content-Security-Policy "default-src 'self'; img-src 'self' data: blob: res.cloudinary.com; connect-src 'self' https://store.jkkniu.edu.bd https://res.cloudinary.com; script-src 'self'; style-src 'self';"

        # Additional security headers
        X-XSS-Protection "1; mode=block"
        
        # Cross-Origin headers (replacing helmet's crossOrigin* settings)
        Cross-Origin-Embedder-Policy "require-corp"
        Cross-Origin-Opener-Policy "same-origin"
        Cross-Origin-Resource-Policy "same-origin"
        
        # Remove Server header
        -Server
    }

}